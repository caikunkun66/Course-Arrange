# 简化学生表改造说明

## 改造概述
简化学生表结构，删除多余字段，只保留核心的昵称字段。

## 删除的字段列表
以下字段已从学生表中删除：
1. ✅ `studentNo` - 学号
2. ✅ `realname` - 真实姓名
3. ✅ `grade` - 年级
4. ✅ `classNo` - 班级编号
5. ✅ `age` - 年龄
6. ✅ `telephone` - 联系电话
7. ✅ `email` - 邮件地址
8. ✅ `address` - 地址

## 保留的字段列表
学生表现在包含以下字段：
- `id` - 主键
- `username` - **昵称**（用于登录，唯一索引）
- `password` - 密码
- `userType` - 用户类型标识（值为3）
- `teacherId` - 所属教师ID
- `avatar` - 头像
- `description` - 签名/描述
- `deleted` - 逻辑删除标识
- `status` - 账号状态（0正常，1封禁）
- `createTime` - 创建时间
- `updateTime` - 更新时间

## 已修改的文件

### 后端文件 (Java)

#### 1. Student.java
- 删除了所有不需要的字段属性
- 保留：username, password, userType, teacherId, avatar, description, deleted, status, createTime, updateTime

#### 2. StudentController.java
主要修改：
- `studentLogin()` - 改为使用 username 登录（原来用 student_no）
- `searchTeacher()` - 搜索改为按 username 模糊查询（原来按 realname）
- `queryStudent()` - 排序改为按 create_time 降序（原来按 student_no）
- `queryStudentsByTeacher()` - 排序改为按 create_time 降序
- `addStudent()` - 检查昵称唯一性（原来检查学号）

#### 3. StudentServiceImpl.java
- `studentLogin()` - 查询条件改为 username（原来是 student_no）

#### 4. TeacherController.java
- `getMyStudents()` - 排序改为按 create_time 降序（原来按 student_no）

### 前端文件 (Vue.js)

#### 5. StudentList.vue
**表格显示简化：**
- 只显示：ID、昵称、所属教师、创建时间
- 删除了学号、姓名、年级、班级、年龄、电话、邮件、地址列

**编辑表单简化：**
- 只保留：昵称、所属教师
- 删除了其他所有字段

**添加表单简化：**
- 只保留：所属教师、昵称、密码
- 删除了学号生成功能和其他字段
- 教师登录后自动填充 teacherId

**数据对象简化：**
- `addFormData` 只包含：teacherId, username, password
- 表单验证规则相应简化

#### 6. ClassManager.vue
**表格显示简化：**
- 只显示：ID、昵称、所属教师、创建时间
- 删除了学号、姓名、电话、邮箱列

**添加表单简化：**
- 只保留：所属教师、昵称、密码
- 删除了学号生成按钮和其他字段

**数据对象简化：**
- `addStudentData` 只包含：teacherId, username, password
- 表单验证规则相应简化
- 删除了 `generateStudentNo()` 方法

## 数据库迁移

### 执行步骤

1. **备份数据库**（必须！）
```bash
mysqldump -u root -p db_course_arrangement > backup_before_simplify.sql
```

2. **执行迁移脚本**
```bash
mysql -u root -p db_course_arrangement < migration_simplify_student.sql
```

### 迁移脚本内容
```sql
-- 删除字段
ALTER TABLE tb_student 
DROP COLUMN IF EXISTS student_no,
DROP COLUMN IF EXISTS realname,
DROP COLUMN IF EXISTS grade,
DROP COLUMN IF EXISTS class_no,
DROP COLUMN IF EXISTS age,
DROP COLUMN IF EXISTS address,
DROP COLUMN IF EXISTS telephone,
DROP COLUMN IF EXISTS email;

-- 添加 username 唯一索引
ALTER TABLE tb_student 
ADD UNIQUE INDEX idx_username (username);

-- 修改 username 为非空
ALTER TABLE tb_student 
MODIFY COLUMN username VARCHAR(50) NOT NULL COMMENT '昵称，用于登录';
```

## 功能变更

### 登录方式
- **之前**：使用学号（student_no）登录
- **现在**：使用昵称（username）登录

### 搜索方式
- **之前**：按姓名（realname）搜索
- **现在**：按昵称（username）搜索

### 学生信息
- **之前**：包含详细信息（学号、姓名、年级、班级、年龄、联系方式等）
- **现在**：极简模式，只有昵称和所属教师

### 排序方式
- **之前**：按学号（student_no）排序
- **现在**：按创建时间（create_time）排序

## 部署步骤

### 1. 停止服务
```bash
# 停止后端服务
# 停止前端服务
```

### 2. 备份数据库
```bash
mysqldump -u root -p db_course_arrangement > backup_$(date +%Y%m%d).sql
```

### 3. 执行数据库迁移
```bash
mysql -u root -p db_course_arrangement < migration_simplify_student.sql
```

### 4. 编译后端
```bash
cd D:\OtherProject\CourseArragement
mvn clean package
```

### 5. 重启后端服务
启动后端应用程序

### 6. 重新构建前端
```bash
cd UI/coursearrange
npm run build  # 生产环境
# 或
npm run dev    # 开发环境
```

### 7. 测试验证
- 测试学生登录（使用昵称）
- 测试添加学生功能
- 测试搜索学生功能
- 测试教师查看学生功能

## 测试检查清单

### 数据库测试
- [ ] 确认字段已删除
- [ ] 确认 username 有唯一索引
- [ ] 确认现有数据正常

### 功能测试
- [ ] 学生使用昵称登录成功
- [ ] 管理员可以添加学生（只填昵称和密码）
- [ ] 教师可以添加学生到自己名下
- [ ] 搜索学生（按昵称）功能正常
- [ ] 编辑学生信息正常
- [ ] 删除学生功能正常
- [ ] 学生列表显示正常
- [ ] 分页功能正常

### 教师功能测试
- [ ] 教师登录后只能看到自己的学生
- [ ] 教师添加学生自动归属到自己名下
- [ ] 教师无法修改学生的所属教师

### 管理员功能测试
- [ ] 管理员可以查看所有学生
- [ ] 管理员可以按教师筛选学生
- [ ] 管理员可以为任意教师添加学生
- [ ] 管理员可以修改学生的所属教师

## 注意事项

1. **昵称唯一性**
   - 昵称现在是唯一的，不能重复
   - 添加学生时会检查昵称是否已存在

2. **登录变更**
   - 告知用户现在使用昵称登录，不再使用学号

3. **数据简化**
   - 学生信息极度简化，只保留核心字段
   - 如果后续需要扩展，需要重新添加字段

4. **现有数据**
   - 如果有历史数据，删除字段会导致数据丢失
   - **务必先备份数据库**

## 回滚方案

如果需要回滚，请：

1. 恢复数据库备份：
```bash
mysql -u root -p db_course_arrangement < backup_YYYYMMDD.sql
```

2. 使用 git 恢复代码：
```bash
git checkout HEAD~1  # 回退到上一个提交
```

3. 重新编译部署

## API 接口变更

### 登录接口
- **路径**：`POST /student/login`
- **变更**：请求参数 username 现在使用昵称而不是学号

### 搜索接口
- **路径**：`GET /student/search/{keyword}`
- **变更**：按昵称模糊搜索，不再按姓名

### 添加学生接口
- **路径**：`POST /student/add`
- **变更**：
  - 只需要：username, password, teacherId
  - 删除了：studentNo, realname, grade, classNo, age, telephone, email, address

### 列表接口
- **路径**：`GET /student/students/{page}`
- **变更**：按创建时间排序，不再按学号

## 优势

1. **数据结构简单** - 易于维护和理解
2. **快速开发** - 减少表单字段，提高录入效率
3. **专注核心** - 关注学生与教师的关联关系
4. **灵活扩展** - 后续可根据需要添加字段

## 建议

1. 如果需要学生的详细信息，建议创建独立的"学生资料表"
2. 如果需要学号，可以考虑使用 ID 作为学号
3. 如果需要分组，可以使用"学习小组"或"培训班"的概念

## 总结

此次改造将学生表极大简化，只保留最核心的昵称字段。这种设计适合：
- 培训机构的学员管理
- 快速录入学生信息
- 专注于教师-学生的对应关系
- 轻量级的学习管理系统

如果您的业务需要更详细的学生信息，可以后续通过创建关联表的方式扩展。

