# 培训排课系统 - 数据库迁移说明

## 概述
本系统已从班级排课系统改造为培训排课系统。主要变更是将班级管理改为学生管理，教师可以查看自己名下的学生。

## 数据库修改

### 1. 修改学生表 (tb_student)
需要添加 `teacher_id` 字段，用于关联教师：

```sql
ALTER TABLE tb_student 
ADD COLUMN teacher_id INT DEFAULT NULL COMMENT '所属教师ID（培训模式）' AFTER class_no;

-- 添加外键约束（可选）
ALTER TABLE tb_student 
ADD CONSTRAINT fk_student_teacher 
FOREIGN KEY (teacher_id) REFERENCES tb_teacher(id) 
ON DELETE SET NULL ON UPDATE CASCADE;
```

### 2. 数据迁移建议
如果系统已有数据，需要考虑以下操作：

#### 方案1: 通过班主任关联
如果原系统中班级有班主任，可以将该班级的学生关联到对应的班主任：

```sql
-- 将学生关联到其班级的班主任
UPDATE tb_student s
INNER JOIN tb_class_info c ON s.class_no = c.class_no
SET s.teacher_id = c.teacher
WHERE c.teacher IS NOT NULL;
```

#### 方案2: 手动分配
在系统后台手动为每个学生分配教师。

### 3. 字段说明

| 字段名 | 类型 | 说明 | 是否必填 |
|--------|------|------|---------|
| teacher_id | INT | 所属教师的ID，关联tb_teacher表 | 否 |

## 功能变更说明

### 1. 管理员功能
- ✅ 可以添加学生并指定所属教师
- ✅ 可以按教师筛选学生
- ✅ 可以查看所有学生
- ✅ 可以编辑学生信息（包括更换教师）

### 2. 教师功能
- ✅ 登录后只能查看自己名下的学生
- ✅ 可以编辑自己学生的信息
- ✅ 无法查看其他教师的学生

### 3. 菜单变更
- 原"班级管理"已改为"学生管理"
- 学生管理包含：
  - 添加学生（仅管理员可见）
  - 学生列表（所有用户可见）

### 4. 保留的功能
- 年级和班级字段仍然保留，可选填写
- 原有的学生注册、登录功能保持不变
- 课表、教学资料等功能保持不变

## 测试建议

### 1. 测试管理员功能
1. 登录管理员账号
2. 进入"学生管理" -> "添加学生"
3. 添加学生时选择教师
4. 在"学生列表"中按教师筛选
5. 编辑学生信息，更换教师

### 2. 测试教师功能
1. 登录教师账号
2. 进入"学生管理" -> "学生列表"
3. 确认只能看到自己名下的学生
4. 尝试编辑学生信息

### 3. 测试数据完整性
1. 确认学生的教师关联正确
2. 确认删除教师时学生的 teacher_id 正确处理（如果设置了外键约束）
3. 确认分页功能正常
4. 确认搜索功能正常

## 回滚方案

如果需要回滚到原系统，执行以下操作：

```sql
-- 删除 teacher_id 字段
ALTER TABLE tb_student DROP COLUMN teacher_id;

-- 如果添加了外键约束，先删除约束
ALTER TABLE tb_student DROP FOREIGN KEY fk_student_teacher;
```

然后恢复前端和后端代码到之前的版本。

## 注意事项

1. **数据备份**: 在执行任何数据库修改前，请务必备份数据库
2. **测试环境**: 建议先在测试环境中验证所有功能正常后再部署到生产环境
3. **用户培训**: 通知用户系统变更，特别是教师用户只能看到自己的学生
4. **权限检查**: 确认教师无法通过API直接访问其他教师的学生数据

## 技术支持

如有问题，请检查：
- 后端日志：查看 API 调用是否正常
- 前端控制台：查看网络请求和错误信息
- 数据库日志：查看 SQL 执行情况

