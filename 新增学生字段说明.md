# 学生表新增字段说明

## 新增字段概述

为学生表添加4个新字段，用于记录学生的课时信息和备注。

## 新增字段列表

| 字段名 | 类型 | 长度 | 默认值 | 说明 |
|--------|------|------|--------|------|
| total_hours | INT | - | 0 | 总课时 |
| completed_hours | INT | - | 0 | 已上课时 |
| course_remark | VARCHAR | 500 | NULL | 课程备注 |
| student_remark | VARCHAR | 500 | NULL | 学生备注 |

## 字段说明

### 1. total_hours（总课时）
- **类型**：整数
- **默认值**：0
- **说明**：学生购买或分配的总课时数
- **用途**：用于记录学生可用的总课时
- **范围**：0-9999

### 2. completed_hours（已上课时）
- **类型**：整数
- **默认值**：0
- **说明**：学生已经完成的课时数
- **用途**：用于记录学生已消耗的课时
- **范围**：0-9999
- **注意**：通常 completed_hours ≤ total_hours

### 3. course_remark（课程备注）
- **类型**：字符串
- **长度**：最多500字符
- **默认值**：NULL
- **说明**：关于学生课程的备注信息
- **用途**：记录学生的课程安排、特殊要求等
- **示例**：
  - "每周三下午3点上课"
  - "需要加强口语练习"
  - "适合基础课程"

### 4. student_remark（学生备注）
- **类型**：字符串
- **长度**：最多500字符
- **默认值**：NULL
- **说明**：关于学生本人的备注信息
- **用途**：记录学生的特点、注意事项等
- **示例**：
  - "学习认真，进度较快"
  - "需要额外关注"
  - "家长要求严格"

## 计算字段

### 剩余课时
- **计算公式**：剩余课时 = 总课时 - 已上课时
- **显示位置**：学生列表、添加/编辑对话框
- **显示样式**：蓝色粗体，单位"课时"

## 已修改的文件

### 后端文件

#### 1. Student.java
添加了4个字段属性：
```java
/**
 * 总课时
 */
private Integer totalHours;

/**
 * 已上课时
 */
private Integer completedHours;

/**
 * 课程备注
 */
private String courseRemark;

/**
 * 学生备注
 */
private String studentRemark;
```

### 前端文件

#### 2. StudentList.vue（学生列表页面）

**表格新增列：**
- 总课时
- 已上课时
- 剩余课时（计算列）
- 课程备注
- 学生备注

**编辑表单新增字段：**
- 总课时（数字输入框，0-9999）
- 已上课时（数字输入框，0-9999）
- 剩余课时（只读显示）
- 课程备注（文本域，500字符）
- 学生备注（文本域，500字符）

**添加表单新增字段：**
- 总课时（数字输入框，默认0）
- 已上课时（数字输入框，默认0）
- 剩余课时（只读显示）
- 课程备注（文本域，选填）
- 学生备注（文本域，选填）

#### 3. ClassManager.vue（班级管理/学生管理页面）

与 StudentList.vue 相同的改动。

### 数据库文件

#### 4. migration_add_student_fields.sql
数据库迁移脚本，包含：
- 添加4个字段的SQL语句
- 为课时字段添加索引
- 验证SQL语句

## 数据库迁移

### 执行步骤

1. **备份数据库**
```bash
mysqldump -u root -p db_course_arrangement > backup_before_add_fields.sql
```

2. **执行迁移脚本**
```bash
mysql -u root -p db_course_arrangement < migration_add_student_fields.sql
```

3. **验证字段**
```sql
DESC tb_student;
```

### 迁移脚本内容
```sql
-- 添加总课时
ALTER TABLE tb_student 
ADD COLUMN total_hours INT DEFAULT 0 COMMENT '总课时' AFTER teacher_id;

-- 添加已上课时
ALTER TABLE tb_student 
ADD COLUMN completed_hours INT DEFAULT 0 COMMENT '已上课时' AFTER total_hours;

-- 添加课程备注
ALTER TABLE tb_student 
ADD COLUMN course_remark VARCHAR(500) DEFAULT NULL COMMENT '课程备注' AFTER completed_hours;

-- 添加学生备注
ALTER TABLE tb_student 
ADD COLUMN student_remark VARCHAR(500) DEFAULT NULL COMMENT '学生备注' AFTER course_remark;

-- 添加索引
ALTER TABLE tb_student 
ADD INDEX idx_total_hours (total_hours),
ADD INDEX idx_completed_hours (completed_hours);
```

## 功能展示

### 学生列表表格

| ID | 昵称 | 所属教师 | 总课时 | 已上课时 | 剩余课时 | 课程备注 | 学生备注 | 创建时间 | 操作 |
|----|------|----------|--------|----------|----------|----------|----------|----------|------|
| 1  | 张三 | 李老师   | 100    | 30       | 70       | 每周三上课 | 学习认真 | 2024-01-01 | 删除 编辑 |

### 添加/编辑学生对话框

表单包含以下字段：
1. 所属教师（下拉选择，必填）
2. 昵称（文本框，必填）
3. 密码（密码框，添加时必填）
4. 总课时（数字输入框，0-9999）
5. 已上课时（数字输入框，0-9999）
6. 剩余课时（只读显示，蓝色粗体）
7. 课程备注（文本域，500字符限制）
8. 学生备注（文本域，500字符限制）

对话框宽度：600px
标签宽度：100px

## 使用场景

### 1. 添加新学生
1. 点击"添加学生"按钮
2. 选择所属教师
3. 输入学生昵称和密码
4. 设置总课时（例如：100）
5. 已上课时默认为0
6. 可选填写课程备注和学生备注
7. 点击"提交"

### 2. 编辑学生信息
1. 点击学生列表的"编辑"按钮
2. 修改课时信息
3. 更新备注信息
4. 点击"提交"保存

### 3. 查看剩余课时
在学生列表中可以直接看到每个学生的剩余课时：
- 剩余课时 = 总课时 - 已上课时
- 自动计算，实时显示

## 业务逻辑

### 课时管理
1. **添加学生**：
   - 设置总课时（购买的课时数）
   - 已上课时初始为0
   - 剩余课时 = 总课时

2. **上课消耗**：
   - 每次上课后，手动更新已上课时
   - 剩余课时自动计算减少

3. **续费充值**：
   - 增加总课时
   - 剩余课时相应增加

4. **课时预警**（建议后续开发）：
   - 当剩余课时 < 10 时，显示警告
   - 当剩余课时 = 0 时，显示提示

### 备注管理
1. **课程备注**：
   - 记录课程安排相关信息
   - 教师和管理员可查看和编辑

2. **学生备注**：
   - 记录学生特点和注意事项
   - 供教师参考

## 测试检查清单

### 数据库测试
- [ ] 执行迁移脚本成功
- [ ] 字段类型正确
- [ ] 默认值正确
- [ ] 索引创建成功

### 后端测试
- [ ] Student 实体类包含新字段
- [ ] 添加学生接口正常
- [ ] 查询学生接口返回新字段
- [ ] 更新学生接口正常

### 前端测试
- [ ] 学生列表显示新字段
- [ ] 剩余课时计算正确
- [ ] 添加学生表单包含新字段
- [ ] 编辑学生表单包含新字段
- [ ] 数字输入框限制正常（0-9999）
- [ ] 文本域字符限制正常（500字符）
- [ ] 备注字段过长时显示省略号
- [ ] 对话框宽度和布局美观

### 功能测试
- [ ] 添加学生时设置课时和备注
- [ ] 编辑学生时修改课时和备注
- [ ] 剩余课时自动计算
- [ ] 教师登录只能看到自己学生的课时信息
- [ ] 管理员可以查看所有学生的课时信息

## 注意事项

1. **课时逻辑**
   - 已上课时不应超过总课时（前端有限制，后端建议也加校验）
   - 课时数据类型为整数，不支持小数课时

2. **备注字段**
   - 最多500字符，超出会被截断
   - 支持换行和特殊字符
   - 列表中过长显示省略号，鼠标悬停查看完整内容

3. **权限控制**
   - 教师只能查看和修改自己学生的信息
   - 管理员可以查看和修改所有学生的信息

4. **数据初始化**
   - 新字段对现有学生默认值：total_hours=0, completed_hours=0
   - 现有学生需要手动设置课时信息

## 后续优化建议

1. **课时预警系统**
   - 剩余课时不足时自动提醒
   - 发送邮件或站内通知

2. **课时历史记录**
   - 记录每次课时变动
   - 包括时间、操作人、变动数量、原因

3. **统计报表**
   - 教师维度：总课时、已消耗、剩余
   - 时间维度：每月课时消耗统计
   - 学生维度：课时使用趋势

4. **批量操作**
   - 批量设置课时
   - 批量更新备注
   - 导入导出课时数据

5. **课时套餐**
   - 预设课时套餐（如：10课时、20课时、50课时）
   - 快速选择套餐

## 部署步骤

1. **停止服务**
2. **备份数据库**
3. **执行数据库迁移**
4. **重新编译后端**：`mvn clean package`
5. **启动后端服务**
6. **重新构建前端**：`npm run build` 或 `npm run dev`
7. **测试验证**

## 总结

本次更新为学生表添加了课时管理和备注功能，使系统更适合培训机构的实际业务需求。

**核心价值：**
- ✅ 清晰的课时管理
- ✅ 灵活的备注系统
- ✅ 实时的剩余课时计算
- ✅ 完善的界面展示

**适用场景：**
- 培训机构学员管理
- 课时制收费模式
- 一对一辅导
- 小班课程管理

